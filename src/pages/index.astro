---
import Header from "../components/Header.astro";
import Hero from "../components/Hero.astro";
import About from "../components/About.astro";
import Projects from "../components/Projects.astro";
import Experience from "../components/Experience.astro";
import Education from "../components/Education.astro";
import Footer from "../components/Footer.astro";
import { siteConfig } from "../config";
import "../styles/global.css";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/Screenplay-2026/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={siteConfig.description} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"
    />
    <title>{siteConfig.name} - {siteConfig.title}</title>
  </head>
  <body>
    <Header />
    <section>
      <div class="hero-and-projects min-h-screen flex flex-col pt-14 md:pt-16">
        <div class="hero-wrapper flex-1 min-h-0 flex flex-col min-h-0">
          <Hero />
        </div>
        <div id="projects" class="projects-row-wrapper flex-shrink-0">
          <Projects carouselRow />
        </div>
      </div>
      <About />
      <Experience />
      <Education />
    </section>
    <Footer />
    <script>
      (function heroAndProjectCarousel() {
        const hero = document.getElementById("hero-carousel");
        const cards = document.querySelectorAll(".project-carousel-card");
        const slides = document.querySelectorAll(".hero-slide");
        const track = document.getElementById("project-cards-track");
        const prevBtns = document.querySelectorAll("#project-cards-prev, #project-cards-prev-single");
        const nextBtns = document.querySelectorAll("#project-cards-next, #project-cards-next-single");
        if (!hero || !cards.length || !slides.length) return;

        let slideIndex = 0;

        function getCardsPerView(): number {
          const w = window.innerWidth;
          if (w >= 1280) return 4;
          if (w >= 680) return 2;
          return 1;
        }

        function getMaxSlideIndex(): number {
          const perView = getCardsPerView();
          if (perView >= 4) return 0;
          if (perView === 2) return 1;
          return 3;
        }

        function goTo(index: number) {
          const i = Math.max(0, Math.min(index, slides.length - 1));
          hero?.setAttribute("data-active-slide", String(i));
          slides.forEach((el, j) => {
            const slide = el as HTMLElement;
            const isActive = j === i;
            slide.style.opacity = isActive ? "1" : "0";
            slide.style.pointerEvents = isActive ? "auto" : "none";
            slide.setAttribute("aria-hidden", String(!isActive));
          });
          cards.forEach((card, j) => {
            card.setAttribute("data-active", String(j === i));
            card.setAttribute("aria-pressed", String(j === i));
          });
        }

        const CARD_WIDTH_PX = 300;

        function updateTrackTransform() {
          if (!track) return;
          const perView = getCardsPerView();
          const maxIdx = getMaxSlideIndex();
          slideIndex = Math.min(slideIndex, maxIdx);
          if (perView >= 4) {
            (track as HTMLElement).style.transform = "translateX(0)";
            return;
          }
          const offsetPx = perView === 1 ? slideIndex * CARD_WIDTH_PX : slideIndex * 2 * CARD_WIDTH_PX;
          (track as HTMLElement).style.transform = `translateX(-${offsetPx}px)`;
        }

        function goPrev() {
          const maxIdx = getMaxSlideIndex();
          if (slideIndex <= 0) return;
          slideIndex--;
          updateTrackTransform();
          const perView = getCardsPerView();
          const firstVisible = perView === 1 ? slideIndex : slideIndex * 2;
          goTo(firstVisible);
        }

        function goNext() {
          const maxIdx = getMaxSlideIndex();
          if (slideIndex >= maxIdx) return;
          slideIndex++;
          updateTrackTransform();
          const perView = getCardsPerView();
          const firstVisible = perView === 1 ? slideIndex : slideIndex * 2;
          goTo(firstVisible);
        }

        cards.forEach((card, index) => {
          card.addEventListener("click", () => {
            const perView = getCardsPerView();
            if (perView >= 4) {
              goTo(index);
              return;
            }
            if (perView === 2) {
              slideIndex = index < 2 ? 0 : 1;
              updateTrackTransform();
            } else {
              slideIndex = index;
              updateTrackTransform();
            }
            goTo(index);
          });
        });

        prevBtns.forEach((btn) => btn.addEventListener("click", goPrev));
        nextBtns.forEach((btn) => btn.addEventListener("click", goNext));

        window.addEventListener("resize", () => {
          const maxIdx = getMaxSlideIndex();
          slideIndex = Math.min(slideIndex, maxIdx);
          updateTrackTransform();
        });

        updateTrackTransform();
      })();
    </script>
  </body>
</html>
